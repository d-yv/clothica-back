openapi: 3.0.0
info:
  title: Clothica API
  version: 1.0.0
  description: REST API for the Clothica online store

servers:
  - url: https://clothica-back.onrender.com
    description: Production server
  - url: http://localhost:3030
    description: Local development server

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        city:
          type: string
        postOfficeNum:
          type: string

    Category:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string

    Good:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        price:
          type: number
        category:
          type: string
        description:
          type: string

    Feedback:
      type: object
      properties:
        _id:
          type: string
        productId:
          type: string
        author:
          type: string
        description:
          type: string
        rate:
          type: integer

paths:
  /api/auth/register:
    post:
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                password:
                  type: string
                phone:
                  type: string
      responses:
        201:
          description: User successfully registered
        400:
          description: Validation error

  /api/auth/login:
    post:
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phone:
                  type: string
                password:
                  type: string
      responses:
        200:
          description: Successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        401:
          description: Invalid credentials

  /api/auth/logout:
    post:
      summary: Logout user
      responses:
        204:
          description: Successfully logged out

  /api/users/me:
    get:
      summary: Get current user info
      security:
        - BearerAuth: []
      responses:
        200:
          description: User info retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        401:
          description: Unauthorized
    patch:
      summary: Update current user info
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                city:
                  type: string
                postOfficeNum:
                  type: string
      responses:
        200:
          description: User updated successfully
        401:
          description: Unauthorized

  /api/categories:
    get:
      summary: Get all categories (paginated)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            default: 12
      responses:
        200:
          description: List of categories
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  perPage:
                    type: integer
                  totalCategories:
                    type: integer
                  totalPages:
                    type: integer
                  categories:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'

  /api/goods:
    get:
      summary: Get all goods (paginated)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            default: 12
      responses:
        200:
          description: List of goods
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  perPage:
                    type: integer
                  totalGoods:
                    type: integer
                  totalPages:
                    type: integer
                  goods:
                    type: array
                    items:
                      $ref: '#/components/schemas/Good'

  /api/goods/{goodId}:
    get:
      summary: Get a good by ID
      parameters:
        - name: goodId
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Product found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Good'
        404:
          description: Product not found

  /api/feedbacks:
    get:
      summary: Get all feedbacks
      responses:
        200:
          description: List of feedbacks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Feedback'

  /api/feedbacks/{productId}:
    get:
      summary: Get feedback for a product
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Feedbacks for product
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Feedback'
    post:
      summary: Add feedback for a product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                author:
                  type: string
                description:
                  type: string
                rate:
                  type: integer
      responses:
        201:
          description: Feedback created successfully
        400:
          description: Validation error

  /api/subscriptions:
    post:
      summary: Subscribe by email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
      responses:
        201:
          description: Subscription created successfully
        400:
          description: Validation error
